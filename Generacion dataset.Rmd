---
title: "Generacion del dataset"
output: html_notebook
---

En este Notebook se realiza la construccion de un dataset formado por el listado de nodos y el valor de las medidas de centralidad para ellos.  

En primer lugar se cargan las librerias necesarias
```{r}
#install.packages("corrplot")
library(igraph)
library(readxl)
library(corrplot)
```

Cargamos los datos del grafo.
```{r}
#Cargo datos
aristas <- read_excel("./Dataset1.xlsx", 
                    sheet = "WeigthedNetwork")
nodos <- read_excel("./Dataset1.xlsx", 
                    sheet = "NetworkNodes")
#Construyo el grafo
grafo_origen <- 
  graph_from_data_frame(d = aristas, vertices = nodos,  directed=F)

#Podo cogiendo como umbral 0.4
grafo <- delete_edges(grafo_origen, E(grafo_origen)[PESO<0.4])
```

Calculo los vectores con las medidas que quiero que tenga el dataframe (degree, centrality, closseness, betweenness).
```{r}
#Degree
deg <- degree(grafo, mode = "all")

#Closeness
close <- closeness(grafo, mode= "all", normalized = T)

#Centrality
eig_cent <- eigen_centrality(grafo, directed = F)

#Betweenness
bet <- betweenness(grafo, directed = F)

```

Genero el dataset creando un dataframe con los vectores obtenidos anteriormente.
```{r}
grafodf <- data.frame(
  "Nodos" = nodos,
  "Degree" = deg,
  "Centrality" = eig_cent$vector,
  "Closeness" = close, 
  "Betweeness" = bet
)
```

Inspeccionamos el dataset generado.
```{r}
print(grafodf)
```
El dataset esta formado por 177 filas y cinco columnas. La primera de ellas contiene los genes que eran los nodos del grafo y las cuatro restantes los datos de las medidas de centralidad.

```{r}
summary(grafodf)
```

Observamos el dataframe graficamente.
```{r}
plot(grafodf[, -1])
```
Y representamos en un histograma cada uno de los atributos para ver su distribucion.
```{r}
hist(grafodf$Degree)
hist(grafodf$Centrality)
hist(grafodf$Closeness)
hist(grafodf$Betweeness)
```
- Degree: los datos estan balanceados. El rango de valores es (0, 80). Hay mayor incidencia en los valores inferiores a 10.
- Centrality: los datos estan balanceados. El rango de balores es (0, 1). Se observa mayor incidencia en los valores inferiores a o.3.
- Closeness. Los datos se agrupan o bien en inferiores a o,01 o en superiores a 0.045. En medio no existen datos. El rango de valores es (0, 0.006)
- Betweeness. La mayoría de ejemplos tienen un valor inferior a 50. El rango de valores es (0, 600).



Generamos la matriz de correlacion
```{r}
cormatrix <- cor(grafodf[,-1], method = "pearson")
print(cormatrix)
```

Ahora de otra forma: 
```{r}
symnum(cormatrix, cutpoints = c(0.2, 0.4, 0.6, 0.8, 0.9, 0.95, 1),
                    symbols = c(" ", ".", ",", "+", "*", "B"),
                    abbr.colnames = TRUE)
```
Finalmente con un dibujo
```{r}
corrplot(cormatrix, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)
```
Y con un mapa de calor:
```{r}
col<- colorRampPalette(c("blue", "white", "red"))(20)
heatmap(x = cormatrix, col = col, symm = TRUE)
```

Este dataset sera usado para aprendizaje supervisado.
Por ello, debe contener un campo que funcione como etiqueta cuyo valor intentaremos predecir.
Este campo será ...
```{r}

```

Finalmente el dataframe se guarda como archivo Excel para poder ser importado.
```{r}
write.csv(grafodf, file="dataframe.csv")
```

